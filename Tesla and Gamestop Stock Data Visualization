!pip install yfinance
!pip install bs4
!pip install nbformat
!pip install matplotlib

import yfinance as yf
import pandas as pd
import requests
from bs4 import BeautifulSoup

import warnings
# Ignore all warnings
warnings.filterwarnings("ignore", category=FutureWarning)

# The make_graph function has been modified to use Matplotlib for static graphs. Earlier, it used Plotly to generate interactive dashboards, which caused issues when uploading the notebook in the MARK assignment submission.


def make_graph(stock_data, revenue_data, stock):
    stock_data_specific = stock_data[stock_data.Date <= '2021-06-14'].copy()
    revenue_data_specific = revenue_data[revenue_data.Date <= '2021-04-30'].copy()
    
    # Clean the Revenue column - remove $, commas, and spaces
    revenue_data_specific['Revenue'] = revenue_data_specific['Revenue'].str.replace('[$, ]', '', regex=True)
    
    # Remove empty values
    revenue_data_specific = revenue_data_specific[revenue_data_specific['Revenue'] != '']
    revenue_data_specific.dropna(subset=['Revenue'], inplace=True)

    fig, axes = plt.subplots(2, 1, figsize=(12, 8), sharex=True)

    # Stock price
    axes[0].plot(pd.to_datetime(stock_data_specific.Date), stock_data_specific.Close.astype("float"), label="Share Price", color="blue")
    axes[0].set_ylabel("Price ($US)")
    axes[0].set_title(f"{stock} - Historical Share Price")

    # Revenue
    axes[1].plot(pd.to_datetime(revenue_data_specific.Date), revenue_data_specific.Revenue.astype("float"), label="Revenue", color="green")
    axes[1].set_ylabel("Revenue ($US Millions)")
    axes[1].set_xlabel("Date")
    axes[1].set_title(f"{stock} - Historical Revenue")

    plt.tight_layout()
    plt.show()

tesla = yf.Ticker("TSLA")

tesla_data = tesla.history(period="max")

tesla_data.reset_index(inplace = True)
tesla_data.head()

import requests
url = "https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBMDeveloperSkillsNetwork-PY0220EN-SkillsNetwork/labs/project/revenue.htm"
html_data = requests.get(url).text

from bs4 import BeautifulSoup
soup = BeautifulSoup(html_data, 'html5lib')

import pandas as pd
tesla_revenue = pd.read_html(html_data)[1]
tesla_revenue.columns = ['Date', 'Revenue']

tesla_revenue["Revenue"] = tesla_revenue['Revenue'].str.replace(',|\$'," ",regex=True)

tesla_revenue.dropna(inplace=True)

tesla_revenue = tesla_revenue[tesla_revenue['Revenue'] != ""]

tesla_revenue.tail()

gamestop = yf.Ticker('GME')

gme_data = gamestop.history(period="max")

gme_data.reset_index(inplace=True)
gme_data.head()

import requests
url = "https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBMDeveloperSkillsNetwork-PY0220EN-SkillsNetwork/labs/project/stock.html"
html_data_2 = requests.get(url).text

from bs4 import BeautifulSoup
soup = BeautifulSoup(html_data_2, "html.parser")

import pandas as pd
gme_revenue = pd.read_html(html_data_2)[0]
gme_revenue.columns = ['Date', 'Revenue']

gme_revenue["Revenue"] = gme_revenue['Revenue'].str.replace(',|\$', "", regex=True)
gme_revenue = gme_revenue[gme_revenue['Revenue'] != '']
gme_revenue.dropna(inplace=True)

gme_data.tail()

make_graph(tesla_data, tesla_revenue, 'Tesla')

make_graph(gme_data, gme_revenue, 'Gamestop')





